<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sharding Database e SQLite | David Silva</title>
    <meta name="description" content="My Personal Blog">
    <link rel="stylesheet" href="/me/assets/style.ce84deb5.css">
    <link rel="modulepreload" href="/me/assets/app.d643be22.js">
    <link rel="modulepreload" href="/me/assets/posts_2024_PT-sharding-database-e-sqlite.md.fcf5c5eb.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-f44a984a><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav no-sidebar" data-v-f44a984a data-v-a50780ff><div class="VPNavBar" data-v-a50780ff data-v-6f1d18b5><div class="container" data-v-6f1d18b5><div class="VPNavBarTitle" data-v-6f1d18b5 data-v-d5925166><a class="title" href="/me/" data-v-d5925166><!--[--><!--]--><!----><!--[-->David Silva<!--]--><!--[--><!--]--></a></div><div class="content" data-v-6f1d18b5><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6f1d18b5 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/me/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Home<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/me/about.html" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Who am I<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/me/archive.html" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Archive<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> Social <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://www.linkedin.com/in/srdavidsilva/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->LinkedIn<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://github.com/sr2ds" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->Github<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://peerlist.io/srdavidsilva" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->Peerlist<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://www.youtube.com/channel/UClu_L56kW3ehOpD0rZWDmHg" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->YouTube<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6f1d18b5 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6f1d18b5 data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-481098f9 data-v-eba7420e><span class="check" data-v-eba7420e><span class="icon" data-v-eba7420e><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-481098f9><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-481098f9><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6f1d18b5 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><!----><!----><div class="VPContent" id="VPContent" data-v-f44a984a data-v-d981fe29><div class="VPDoc has-aside" data-v-d981fe29 data-v-cfb513e0><div class="container" data-v-cfb513e0><div class="aside" data-v-cfb513e0><div class="aside-curtain" data-v-cfb513e0></div><div class="aside-container" data-v-cfb513e0><div class="aside-content" data-v-cfb513e0><div class="VPDocAside" data-v-cfb513e0 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-cfb513e0><div class="content-container" data-v-cfb513e0><!--[--><!--]--><main class="main" data-v-cfb513e0><div style="position:relative;" class="vp-doc _me_posts_2024_PT-sharding-database-e-sqlite" data-v-cfb513e0><div><h1 id="sharding-database-e-sqlite" tabindex="-1">Sharding Database e SQLite <a class="header-anchor" href="#sharding-database-e-sqlite" aria-hidden="true">#</a></h1><p>Recentemente, precisei buscar uma solução para distribuir uma única base de dados em múltiplos arquivos. Dadas algumas premissas e necessidades, fui buscar opções, entender um pouco sobre como isso funciona (limitações, prós, contras, etc.), e vou listar aqui um pouco desse aprendizado, apresentar os problemas e mostrar as soluções que fui encontrando.</p><p>Para contextualizar, isso se refere ao projeto <a href="https://github.com/sr2ds/coeur" target="_blank" rel="noreferrer">Coeur</a> e vou trazer exemplos de código de lá para cá.</p><h2 id="o-problema" tabindex="-1">O problema <a class="header-anchor" href="#o-problema" aria-hidden="true">#</a></h2><iframe src="https://giphy.com/embed/ddugUSEmg5IFM8cPSD" width="480" height="360" style="" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/ProBitExchange-meme-running-joke-ddugUSEmg5IFM8cPSD">via GIPHY</a></p><p>O GitHub limita o tamanho dos commits a 100 MB. Ou seja, se você está tentando fazer commit de uma base <code>SQLite</code> com mais de 100 MB, você não conseguirá.</p><p>Aliás, você vai conseguir depois de habilitar o <a href="https://docs.github.com/en/repositories/working-with-files/managing-large-files/configuring-git-large-file-storage" target="_blank" rel="noreferrer"><code>LFS</code></a> no seu repositório, e de fato isso funcionará. O problema é que isso vai te levar à beira do upgrade do data plan do GitHub e, assim que você consumir <code>1 GB</code> de banda, precisará pagar para continuar seus commits.</p><p>Então, precisei ir em busca de uma forma para que o arquivo contendo os dados dos projetos fosse dividido em alguns arquivos menores, permitindo o uso do repositório comum do GitHub. E chegamos ao que significa Sharding.</p><blockquote><p>Sharding é uma técnica de particionamento de dados que distribui os dados por várias máquinas ou arquivos, o que pode ajudar a aumentar a escalabilidade e a performance de um banco de dados.</p></blockquote><p>Se você está se perguntando por que eu estou armazenando dados em um repositório ao invés de subir uma instância em alguma cloud, é porque a premissa do <code>Coeur</code> é permitir que blogs sejam criados e mantidos utilizando o máximo de recursos gratuitos. Então, mantemos tudo que é necessário no repositório e fazemos deploy da build para o Netlify ou GitHub Pages.</p><p>Pronto, dada a compreensão do problema, vamos pesquisar por soluções.</p><h2 id="buscando-solucoes" tabindex="-1">Buscando soluções <a class="header-anchor" href="#buscando-solucoes" aria-hidden="true">#</a></h2><iframe src="https://giphy.com/embed/L1ZqGzJDFYC7C" width="480" height="480" style="" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/mrw-dont-length-L1ZqGzJDFYC7C">via GIPHY</a></p><p>Eu quero usar um banco de dados, ao invés de arquivos como os outros frameworks fazem, pois preciso fazer coisas como filtro, paginação e ordenação sem a necessidade de popular os dados na memória RAM e fazer isso em tempo de execução. O fato do design do <code>Coeur</code> ser baseado nessa premissa me permite ter um ótimo controle do uso dos recursos que minhas builds consomem, independente do tamanho do projeto.</p><p>Dito isso, pensando nas soluções mais comuns de banco de dados que conheço, seja relacionais ou não-relacionais, como <code>MySQL</code>, <code>PostgreSQL</code> ou <code>MongoDB</code>, por exemplo, todos carecem do serviço estar em execução para serem consumidos.</p><p>Ou seja, você precisa dar play no <code>mysqld</code> para poder manipular o banco de dados <code>MySQL</code>.</p><p>No final das contas, todos criam arquivos locais, mas possuem essa &quot;interface&quot; para que o banco de dados funcione. Essa &quot;interface&quot; é quem faz a gestão das conexões, processa consultas, etc. Honestamente, não sei se seria possível fazer query em qualquer um deles por baixo dos panos e, mesmo que fosse, a curva para fazer esse tipo de trâmite me parece muito maior. Então, as soluções que conhecia não iriam me ajudar.</p><p>Encontrei alguns nomes como: TiDB, RocksDB, Apache Derby e CockroachDB.</p><p>Belos nomes e também são legais e, com exceção do RocksDB, que é baseado em chave-valor, os outros poderiam talvez me atender bem e o TiDB até faz o sharding de forma automática. Ou seja, ele quebra o arquivo sozinho e faz a gestão disso por conta própria. De fato, seria uma mão na roda.</p><p>Mas aí me deparei com outro problema. Está planejado em meu roadmap fornecer uma maneira de administrar os dados de uma maneira bem simples depois, tipo um painel para manipular os dados, criar, editar, etc. Eu poderia fazer um frontend para isso, criar as rotas, etc. Independente do banco de dados escolhido, vai funcionar se eu criar tudo na mão. Mas não faz muito sentido eu gastar muito tempo com essa parte visual de frontend, então considerei usar o <code>sqladmin</code> com <code>FastAPI</code> e <code>SQLAlchemy</code>. É super simples e amigável, não precisarei fazer nenhum frontend próprio e poderei resolver essa questão muito bem. É bonito, funcional e resolverá bem. Mas isso me colocou outro impasse, pois estes outros bancos não são exatamente compatíveis com <code>SQLAlchemy</code>. Então, se eu optasse pelo <code>TiDB</code>, por exemplo, ganharia o benefício de ter o sharding feito automaticamente, mas perderia o benefício de usar a interface <code>sqladmin</code>, a qual sei que é eficiente e me permitirá não me preocupar com isso depois. Nota: Talvez o projeto do painel ainda precisará de algum nível de personalização por conta do sharding, vamos ver.</p><p>Foi então que, após alguns dias pensando e analisando, considerei que o melhor cenário (talvez não seja o melhor, mas resolveu bem) seria eu abraçar o &quot;sharding&quot; manualmente e continuar no <code>SQLite</code> mesmo, o bom e velho <code>SQLite</code>. Ou seja, considerando que ele dê suporte a isso e eu já tinha as coisas funcionando com ele, bora fazer o <code>sharding</code> nele mesmo.</p><p>E foi o que fiz. Porém, ainda há uma ressalva, por padrão o SQLite só permite fazer attach de 10 bases de dados. Por hora, está ok. Mas no futuro, para utilizá-lo será necessário re-compilar o <code>sqlite</code> fazer aumento desse limite. E é algo relativamente simples, será tranquilo de criar uma instrução para isso depois, então vamos assim.</p><h2 id="sqlite" tabindex="-1">SQLite <a class="header-anchor" href="#sqlite" aria-hidden="true">#</a></h2><p>Se você nunca mexeu com SQLite, isso pode te ajudar a entender melhor:</p><blockquote><p>SQLite é um sistema de gerenciamento de banco de dados relacional (RDBMS) leve e autônomo que não requer um servidor separado para operar. Ele é amplamente utilizado em aplicações onde um banco de dados completo, com funcionalidades de um servidor, não é necessário, oferecendo uma solução simples, eficiente e de fácil implantação. Aqui estão algumas características e usos importantes do SQLite:</p><p>Autônomo e Sem Servidor: Diferente de muitos outros RDBMSs que requerem um servidor separado para funcionar (como MySQL ou PostgreSQL), o SQLite é integrado diretamente à aplicação. Ele armazena dados em um único arquivo de banco de dados no sistema de arquivos do host.</p><p>Portabilidade: Como o banco de dados é apenas um arquivo, é fácil de transportar entre diferentes sistemas operacionais. Basta copiar o arquivo para mover o banco de dados.</p><p>Desempenho: Para muitas aplicações, especialmente aquelas que não necessitam de um sistema de banco de dados complexo, o SQLite pode ser mais rápido que outros RDBMSs, devido à ausência de sobrecarga de comunicação entre um cliente e servidor.</p><p>Tamanho Compacto: O código-fonte do SQLite é muito pequeno em comparação com outros sistemas de gerenciamento de banco de dados, tornando-o adequado para dispositivos com recursos limitados, como smartphones e dispositivos IoT.</p><p>Facilidade de Uso: A instalação e a configuração são simples. Não há necessidade de um administrador de banco de dados (DBA) para configurar ou manter o SQLite.</p><p>ACID: SQLite é totalmente compatível com ACID (Atomicidade, Consistência, Isolamento, Durabilidade), garantindo a integridade dos dados, mesmo após falhas de sistema.</p></blockquote><p>O <code>Coeur</code> basicamente possui duas operações: a primeira são os inserts que são feitos ao executar o script de importação de posts markdown. Ou seja, dado um diretório com os arquivos markdown, o script vai iterar recursivamente e converter cada markdown para uma entrada no banco de dados.</p><p>A segunda é para fazer as builds, pois precisamos iterar de forma paginada em todos os registros gravados para fazer a criação dos arquivos estáticos.</p><p>A primeira operação, que faz o INSERT, é quem usa de forma excessiva a magia do sharding e é a responsável por fazer esse particionamento. As operações de consulta também precisam de alterações, pois agora a paginação será feita considerando bancos anexados ao primário, e não em um único mais. Além disso, infelizmente o <code>SQLAlchemy.orm</code> não simplifica esse tipo de operação, então também foi necessário alguma customização no Model que temos lá.</p><p>Não foi muito óbvio separar as responsabilidades, mas consegui chegar em um ponto aceitável de abstração e, por fim, temos duas classes: a <code>ShardingManager</code>, que é responsável por criar os bancos dinamicamente, analisar se está na hora de criar um novo banco, anexar os bancos na sessão principal e gerar a query que utiliza todos os bancos ao mesmo tempo e a <code>DatabaseManager</code>que cuida da sessão e operações.</p><p>Inclusive, vale aqui uma pausa para explicar isso.</p><p>Por conta do <code>SQLite</code> não fazer a gestão do particionamento sozinho, temos que construir a inteligência que vai analisar se o banco de dados atual já atingiu o máximo de tamanho desejado e, caso sim, criar o banco e anexá-lo na sessão utilizada. Ou seja, se os bancos já estão criados, a sessão precisa iniciar e já anexar todos. Caso não estejam, precisamos fazer isso automaticamente.</p><p>Além disso, precisamos customizar o SELECT principal para fazer UNION ALL em todos os SELECTs, banco por banco.</p><p>Você pode ver o arquivo completo <a href="https://github.com/sr2ds/coeur/blob/main/coeur/apps/ssg/db.py" target="_blank" rel="noreferrer">aqui: db.py</a>, mas vou colar a classe aqui e fazer alguns comentários explicativos para analisarmos juntos cada método:</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ShardingManager</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># tamanho máximo em MB que eu quero considerar base para parar de usar o arquivo</span></span>
<span class="line"><span style="color:#A6ACCD;">    MAX_FILE_SIZE_MB </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># nome do banco padrão</span></span>
<span class="line"><span style="color:#A6ACCD;">    DB1_NAME </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">db1.sqlite</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#FFCB6B;">staticmethod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># simplesmente retorna todos os arquivos dentro do diretorio db, onde os bancos são criados</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># isso é usado para quase tudo, tipo anexar bancos, saber qual é o menor, etc</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_databases</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">filename </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> filename </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listdir</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">db</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#FFCB6B;">staticmethod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># baseado na lista de bancos que existem, eu preciso saber o que possui o tamanho menor</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># e retornar somente o nome dele, sem extencão</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_smallest_db</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">        smallest_db </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">min</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">            ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_databases</span><span style="color:#89DDFF;">(),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">=</span><span style="color:#C792EA;">lambda</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getsize</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;db/</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">db</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">splitext</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">smallest_db</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#FFCB6B;">staticmethod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># para fazer as queries precisa-se especificar o nome da tabela contendo o banco</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># com excessão do banco 1, que apenas o nome da tabela é necessário</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">_get_posts_table_by_db</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">db_file</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        db </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">splitext</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">db_file</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">posts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> db </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">db1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">db</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">.posts&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#FFCB6B;">staticmethod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># cria o banco de dados novo</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># sendo que sempre será em númerica incremental: 1,2,3,4, etc</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># é necessário criar uma nova sessão para fazer isso pois esse método</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># é executado após um commit na sessão atual</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># o novo banco é criado utilizando a estrutura de um banco já existente</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">create_new_database</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">        engine </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">create_engine</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;sqlite:///db/</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">DB1_NAME</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        Session </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sessionmaker</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">bind</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">engine</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        session </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Session</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        new_db_filename </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;db</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_databases</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1}</span><span style="color:#C3E88D;">.sqlite&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        file_prefix </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">splitext</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">new_db_filename</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">        session</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;ATTACH DATABASE &#39;db/</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">new_db_filename</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&#39; AS </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">file_prefix</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">        session</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;CREATE TABLE </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">file_prefix</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">.posts AS SELECT * FROM posts WHERE 0&quot;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">        session</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">commit</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        session</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">close</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#FFCB6B;">staticmethod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># este método ajuda as futuras queries a serem executadas considerando todas as tabelas</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># lembrando que precisa especificar db.table para query, então aqui a gente faz para todos dbs</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">generate_union_posts_query</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fields</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        union_queries </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> filename </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_databases</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">            table_name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_get_posts_table_by_db</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">filename</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">            union_queries</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;SELECT </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">fields</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;"> FROM </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">table_name</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> UNION ALL </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">union_queries</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#FFCB6B;">staticmethod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># esse método é responsável por fazer attach dos bancos na sessão atual</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># ele é chamada pelo evento de criação da conexão lá no create_engine</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">attach_databases</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">session</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Session</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> databases </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_databases</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> filename </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> databases</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> filename</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endswith</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.sqlite</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> filename </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">DB1_NAME</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                    session</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                        </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;ATTACH DATABASE &#39;db/</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">filename</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&#39; AS </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">splitext</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">filename</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#FFCB6B;">staticmethod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># este método é chamado via evento após cada commit</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># ele é responsável por analisar se há necessidade de criar um novo banco de dados</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># e caso seja, chama o método create_new_database</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># que pensando agora nem precisaria existir o método create_new_database kkkk</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">manage_database_size</span><span style="color:#89DDFF;">(*</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        smallest_db </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_smallest_db</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        file_size </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getsize</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;db/</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">smallest_db</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">.sqlite&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> file_size </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">MAX_FILE_SIZE_MB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1024</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1024</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create_new_database</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>Já na classe <code>DatabaManager</code> eu mantive as coisas mais normais de banco de dados. Também precisei fazer uma gambiarrinha na classe do model para trocar o schema dinamicamente, mas já tive ideias melhores para isso isso, só que não mexi ainda.</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki"><code><span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">DatabaseManager</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">__init__</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">self</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># aqui a gente faz setup da classe que é usada lá dentro do sistema</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># cria a conexão e define os métodos que serão chamados em determinados eventos para</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># gerir a questão do particionamento</span></span>
<span class="line"><span style="color:#A6ACCD;">        engine </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">create_engine</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;sqlite:///db/</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">DB1_NAME</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        event</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">engine</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">connect</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">attach_databases</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">Session</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sessionmaker</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">bind</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">engine</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">session</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Session</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        event</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">session</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">after_commit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">manage_database_size</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">new_post</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">content_format</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">extra</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">date</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">image</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># aqui precisei fazer a gambiarra com o model do Post, mas da pra ficar mais abstrato</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># vou melhorar isso em breve</span></span>
<span class="line"><span style="color:#A6ACCD;">        smallest_db </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_smallest_db</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Post</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">title</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;">content</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">content</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;">content_format</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">content_format</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;">extra</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">extra</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;">date</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">date</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;">image</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">image</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#676E95;"># would be nice do it better, but sqlalchemy orm has no support</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;">schema</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">smallest_db </span><span style="color:#89DDFF;">if</span><span style="color:#82AAFF;"> smallest_db </span><span style="color:#89DDFF;">!=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">db1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">else</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">None,</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">_fetch_pagination_mapped</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">offset</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">limit</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># esse método executa as queries agrupadas de forma paginada e </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># faz o map para o model sqlalchemy.orm no final </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># fiz isso para não precisar alterar como o dado é acessado nos outros lugares</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># e manter o padrão</span></span>
<span class="line"><span style="color:#A6ACCD;">        union_query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ShardingManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">generate_union_posts_query</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        query </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;SELECT * FROM (</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">union_query</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">) AS all_posts LIMIT :limit OFFSET :offset&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">session</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">text</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">limit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> limit</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">offset</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> offset</span><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">        posts </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fetchall</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        posts_dicts </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> post_tuple </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> posts</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            post_dict </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> idx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> column </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">enumerate</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">keys</span><span style="color:#89DDFF;">()):</span></span>
<span class="line"><span style="color:#A6ACCD;">                post_dict</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">column</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> post_tuple</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">idx</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">            posts_dicts</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">post_dict</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">Post</span><span style="color:#89DDFF;">(**</span><span style="color:#82AAFF;">post_dict</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> post_dict </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> posts_dicts</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">generator_page_posts</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">total_by_page</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">max_posts_server</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># esse método é responsável por fazer a paginação mas retornando um generator</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># então eu consigo iterar em todas as páginas sem carregar tudo na memória e </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># abstrair de forma bem legal para ser consumido lá do outro lado</span></span>
<span class="line"><span style="color:#A6ACCD;">        total </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">count_total_posts</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        fetched </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">        offset </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> max_posts_server </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> total_by_page </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> max_posts_server</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            total_by_page </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> max_posts_server</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> fetched </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> total</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            posts </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_fetch_pagination_mapped</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">offset</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">offset</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">limit</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">total_by_page</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">            fetched </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">posts</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">            offset </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> offset </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> total_by_page</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">yield</span><span style="color:#A6ACCD;"> posts</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> max_posts_server </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> fetched </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> max_posts_server</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">break</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>Então resumindo a funcionalidade, o que acontece é que após um commit ser executado, nosso analisador verifica se o banco atual já atingiu o tamanho permitido, caso sim, o novo banco será criado e anexado a sessão atual. Além disso, O INSERT precisa definir que o próximo INSERT será feito no novo banco pois isso não é automático.</p><p>E para fazer as consultas, precisamos fazer UNION dos selects de todos os bancos e aí podemos fazer consultas de forma global.</p><p>Falando assim parece bem simples, de fato talvez seja mesmo, principalmente agora que está pronto kkk</p><p>Te convido a dar uma olhada no <a href="https://github.com/sr2ds/coeur" target="_blank" rel="noreferrer">repositório</a> e aprender um pouco mais, caso tenha algumas ideias para melhorar algo, fique a vontade. Não sou ninja em nada e sempre podemos melhorar algo.</p><p>Valeu, até a próxima!</p><iframe src="https://giphy.com/embed/3o7qDEq2bMbcbPRQ2c" width="480" height="331" style="" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/mic-drop-peace-out-obama-3o7qDEq2bMbcbPRQ2c">via GIPHY</a></p></div></div></main><!--[--><!--]--><!----><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter" data-v-f44a984a data-v-9f24cc86><div class="container" data-v-9f24cc86><p class="message" data-v-9f24cc86>Released under the MIT License.</p><!----></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"about.md\":\"4ded5be7\",\"archive.md\":\"1566dfac\",\"index.md\":\"55ac6bcd\",\"posts_2020_apagando-o-cache-do-redis.md\":\"a855ddec\",\"posts_2020_bloquear-tráfego-por-ip-x-forwarded-for-apache-2.4.md\":\"18cffe9d\",\"posts_2020_docker-instalacao-e-primeiros-passos.md\":\"007e8194\",\"posts_2020_docker-introducao-concentual.md\":\"f10f1d5e\",\"posts_2020_graylog-parou-após-disco-cheio.md\":\"7da74268\",\"posts_2020_instalando-docker-no-oracle-linux.md\":\"0c505261\",\"posts_2020_integrando-jenkins-e-gitlab.md\":\"4a7d8c49\",\"posts_2020_publicando-imagens-no-ocir-registry-oracle-cloud.md\":\"9453ac5c\",\"posts_2022_pt-checklist-to-api-rest.md\":\"79d7dc56\",\"posts_2022_pt-rust-language-and-me.md\":\"0956212f\",\"posts_2022_ensure-a-beaut-code-with-laravel-pint.md\":\"1b5871fa\",\"posts_2022_testing-and-mocking-with-laravel.md\":\"f491931a\",\"posts_2024_pt-desafios-e-solucoes-na-gestao-de-blogs-com-mais-de-50-mil-artigos-ia-rust-e-vue.md\":\"ff17a8c2\",\"posts_2024_pt-dump-mental-blogs-parte-2.md\":\"1c35d559\",\"posts_2024_pt-dump-mental-proximos-passos-do-desafio-blog-com-100k-posts.md\":\"a6c2a786\",\"posts_2024_pt-escalando-de-64k-para-100k-artigos.md\":\"02986624\",\"posts_2024_pt-python-as-my-tool.md\":\"c947ed07\",\"posts_2024_pt-sharding-database-e-sqlite.md\":\"fcf5c5eb\",\"posts_2025_01_2025-e-um-novo-velho-hobby-pentest.md\":\"65ce7957\"}")</script>
    <script type="module" async src="/me/assets/app.d643be22.js"></script>
    
  </body>
</html>